# ãƒ†ã‚¹ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€KeyboardRemapper ã®ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã¨å®Ÿè¡Œæ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

## ãƒ†ã‚¹ãƒˆæ¦‚è¦

KeyboardRemapper ã¯ã€**ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆå¤‰æ›ãŒæ­£ã—ãå‡¦ç†ã•ã‚Œã¦ã„ã‚‹ã‹**ã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã®åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã‚’å‚™ãˆã¦ã„ã¾ã™ã€‚

### ãƒ†ã‚¹ãƒˆã®ç¨®é¡

1. **ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ** - ã‚­ãƒ¼ãƒªãƒãƒƒãƒ—ã‚¨ãƒ³ã‚¸ãƒ³ã®æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
2. **çµ±åˆãƒ†ã‚¹ãƒˆ** - ãƒ‡ãƒã‚¤ã‚¹æ¤œå‡ºã¨ãƒãƒƒãƒ”ãƒ³ã‚°è¨­å®šã®çµ±åˆãƒ†ã‚¹ãƒˆ
3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ** - é«˜é€Ÿã‚­ãƒ¼å…¥åŠ›æ™‚ã®å‡¦ç†æ€§èƒ½ãƒ†ã‚¹ãƒˆ

## ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

### ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
KeyboardRemapper.Tests/
â”œâ”€â”€ KeyboardRemapper.Tests.csproj
â””â”€â”€ KeyRemapEngineTests.cs
```

### ãƒ†ã‚¹ãƒˆã‚«ãƒ†ã‚´ãƒª

#### 1. ãƒªãƒãƒƒãƒ—ãƒ†ã‚¹ãƒˆ

**ç›®çš„**: å˜ä¸€ã‚­ãƒ¼ã‹ã‚‰åˆ¥ã®ã‚­ãƒ¼ã¸ã®ãƒªãƒãƒƒãƒ—ãŒæ­£ã—ãæ©Ÿèƒ½ã™ã‚‹ã“ã¨ã‚’ç¢ºèª

```csharp
[Fact]
public void TestRemapCapsLockToLCtrl()
{
    // CapsLock -> LCtrl ã®ãƒªãƒãƒƒãƒ—ã‚’æ¤œè¨¼
}

[Fact]
public void TestRemapMultipleKeys()
{
    // è¤‡æ•°ã‚­ãƒ¼ã®åŒæ™‚ãƒªãƒãƒƒãƒ—ã‚’æ¤œè¨¼
}

[Fact]
public void TestRemapKeyRelease()
{
    // ã‚­ãƒ¼ãƒªãƒªãƒ¼ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã®å‡¦ç†ã‚’æ¤œè¨¼
}
```

**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹**:
- âœ… CapsLock â†’ LCtrl
- âœ… Escape â†’ CapsLock
- âœ… è¤‡æ•°ã‚­ãƒ¼ã®åŒæ™‚ãƒªãƒãƒƒãƒ—
- âœ… ã‚­ãƒ¼ãƒ—ãƒ¬ã‚¹/ãƒªãƒªãƒ¼ã‚¹ã®ä¸¡æ–¹

#### 2. ã‚¹ãƒ¯ãƒƒãƒ—ãƒ†ã‚¹ãƒˆ

**ç›®çš„**: 2ã¤ã®ã‚­ãƒ¼ã®äº¤æ›ãŒåŒæ–¹å‘ã§æ­£ã—ãæ©Ÿèƒ½ã™ã‚‹ã“ã¨ã‚’ç¢ºèª

```csharp
[Fact]
public void TestSwapCapsLockAndLCtrl()
{
    // CapsLock <-> LCtrl ã®ã‚¹ãƒ¯ãƒƒãƒ—ã‚’æ¤œè¨¼
}

[Fact]
public void TestSwapMultipleKeyPairs()
{
    // è¤‡æ•°ã‚­ãƒ¼ãƒšã‚¢ã®ã‚¹ãƒ¯ãƒƒãƒ—ã‚’æ¤œè¨¼
}
```

**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹**:
- âœ… CapsLock â†” LCtrl
- âœ… LShift â†” LAlt
- âœ… è¤‡æ•°ã‚­ãƒ¼ãƒšã‚¢ã®åŒæ™‚ã‚¹ãƒ¯ãƒƒãƒ—
- âœ… åŒæ–¹å‘ã®å¤‰æ›ç¢ºèª

#### 3. ç„¡åŠ¹åŒ–ãƒ†ã‚¹ãƒˆ

**ç›®çš„**: ã‚­ãƒ¼ã‚’å®Œå…¨ã«ç„¡åŠ¹åŒ–ã§ãã‚‹ã“ã¨ã‚’ç¢ºèª

```csharp
[Fact]
public void TestDisableKey()
{
    // CapsLock ã‚’ç„¡åŠ¹åŒ–
}

[Fact]
public void TestDisableMultipleKeys()
{
    // è¤‡æ•°ã‚­ãƒ¼ã‚’ç„¡åŠ¹åŒ–
}
```

**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹**:
- âœ… å˜ä¸€ã‚­ãƒ¼ã®ç„¡åŠ¹åŒ–
- âœ… è¤‡æ•°ã‚­ãƒ¼ã®ç„¡åŠ¹åŒ–
- âœ… ç„¡åŠ¹åŒ–ã‚­ãƒ¼ã®ã‚¤ãƒ™ãƒ³ãƒˆæ¤œå‡º

#### 4. ãƒ‡ãƒã‚¤ã‚¹åˆ¥ãƒ†ã‚¹ãƒˆ

**ç›®çš„**: è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹ã§ç•°ãªã‚‹ãƒãƒƒãƒ”ãƒ³ã‚°ãŒç‹¬ç«‹ã—ã¦æ©Ÿèƒ½ã™ã‚‹ã“ã¨ã‚’ç¢ºèª

```csharp
[Fact]
public void TestDeviceSpecificMapping()
{
    // ãƒ‡ãƒã‚¤ã‚¹1: CapsLock -> LCtrl
    // ãƒ‡ãƒã‚¤ã‚¹2: CapsLock -> Escape
    // å„ãƒ‡ãƒã‚¤ã‚¹ã§ç•°ãªã‚‹ãƒãƒƒãƒ”ãƒ³ã‚°ãŒé©ç”¨ã•ã‚Œã‚‹ã“ã¨ã‚’æ¤œè¨¼
}

[Fact]
public void TestUnmappedKeyPassthrough()
{
    // ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã¦ã„ãªã„ã‚­ãƒ¼ãŒãã®ã¾ã¾é€šéã™ã‚‹ã“ã¨ã‚’æ¤œè¨¼
}
```

**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹**:
- âœ… è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹ã®ç‹¬ç«‹ã—ãŸãƒãƒƒãƒ”ãƒ³ã‚°
- âœ… ãƒãƒƒãƒ”ãƒ³ã‚°ãªã—ã®ã‚­ãƒ¼ã®é€šé
- âœ… ãƒ‡ãƒã‚¤ã‚¹è­˜åˆ¥ã®æ­£ç¢ºæ€§

#### 5. ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ

**ç›®çš„**: äºˆæœŸã—ãªã„å…¥åŠ›ã‚„å¢ƒç•Œæ¡ä»¶ã‚’å‡¦ç†ã§ãã‚‹ã“ã¨ã‚’ç¢ºèª

```csharp
[Fact]
public void TestEmptyMapping()
{
    // ãƒãƒƒãƒ”ãƒ³ã‚°ãªã—ã®çŠ¶æ…‹ã§ã‚­ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‡¦ç†
}

[Fact]
public void TestNonexistentDevice()
{
    // å­˜åœ¨ã—ãªã„ãƒ‡ãƒã‚¤ã‚¹IDã§ã®ãƒãƒƒãƒ”ãƒ³ã‚°å‡¦ç†
}

[Fact]
public void TestCaseSensitivity()
{
    // ã‚­ãƒ¼åã®å¤§æ–‡å­—å°æ–‡å­—ã®åŒºåˆ¥ã‚’ç¢ºèª
}

[Fact]
public void TestRapidKeyPresses()
{
    // é«˜é€Ÿé€£ç¶šã‚­ãƒ¼ãƒ—ãƒ¬ã‚¹ã®å‡¦ç†ã‚’æ¤œè¨¼
}
```

**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹**:
- âœ… ç©ºã®ãƒãƒƒãƒ”ãƒ³ã‚°
- âœ… å­˜åœ¨ã—ãªã„ãƒ‡ãƒã‚¤ã‚¹
- âœ… ã‚­ãƒ¼åã®å¤§æ–‡å­—å°æ–‡å­—åŒºåˆ¥
- âœ… 100å›ã®é€£ç¶šã‚­ãƒ¼ãƒ—ãƒ¬ã‚¹

#### 6. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

**ç›®çš„**: é«˜è² è·æ™‚ã®å‡¦ç†æ€§èƒ½ãŒè¨±å®¹ç¯„å›²å†…ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª

```csharp
[Fact]
public void TestPerformanceWithManyMappings()
{
    // 1000å›ã®ã‚­ãƒ¼ãƒ—ãƒ¬ã‚¹å‡¦ç†ãŒ1ç§’ä»¥å†…ã«å®Œäº†ã™ã‚‹ã“ã¨ã‚’æ¤œè¨¼
}
```

**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹**:
- âœ… 10å€‹ã®ãƒãƒƒãƒ”ãƒ³ã‚° + 1000å›ã®ã‚­ãƒ¼ãƒ—ãƒ¬ã‚¹
- âœ… å‡¦ç†æ™‚é–“: 1ç§’ä»¥å†…
- âœ… ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: æœ€å°é™

## ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ

### å‰ææ¡ä»¶

- .NET 8.0 ä»¥ä¸Š
- Visual Studio 2022 ã¾ãŸã¯ VS Code

### ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§ã®å®Ÿè¡Œ

#### ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ

```bash
dotnet test
```

#### ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã¿å®Ÿè¡Œ

```bash
dotnet test KeyboardRemapper.Tests/KeyboardRemapper.Tests.csproj
```

#### è©³ç´°å‡ºåŠ›ã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ

```bash
dotnet test -v detailed
```

#### ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã‚«ãƒ†ã‚´ãƒªã®ã¿å®Ÿè¡Œ

```bash
# ãƒªãƒãƒƒãƒ—ãƒ†ã‚¹ãƒˆã®ã¿
dotnet test --filter "FullyQualifiedName~RemapTest"

# ã‚¹ãƒ¯ãƒƒãƒ—ãƒ†ã‚¹ãƒˆã®ã¿
dotnet test --filter "FullyQualifiedName~SwapTest"

# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã®ã¿
dotnet test --filter "FullyQualifiedName~Performance"
```

#### ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’å–å¾—

```bash
dotnet test /p:CollectCoverage=true /p:CoverageFormat=opencover
```

### Visual Studio ã§ã®å®Ÿè¡Œ

1. **ãƒ†ã‚¹ãƒˆã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’é–‹ã**: `Test` â†’ `Test Explorer`
2. **ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ**: `Run All Tests`
3. **ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ**: ãƒ†ã‚¹ãƒˆã‚’å³ã‚¯ãƒªãƒƒã‚¯ â†’ `Run`
4. **ãƒ‡ãƒãƒƒã‚°å®Ÿè¡Œ**: ãƒ†ã‚¹ãƒˆã‚’å³ã‚¯ãƒªãƒƒã‚¯ â†’ `Debug`

## GitHub Actions ã§ã®ãƒ†ã‚¹ãƒˆ

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ¦‚è¦

GitHub ã«ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ã¨ã€è‡ªå‹•çš„ã«ä»¥ä¸‹ã®ãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œã•ã‚Œã¾ã™:

1. **ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ** (Debug/Release)
2. **ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆå¤‰æ›ãƒ†ã‚¹ãƒˆ**
3. **ãƒ‡ãƒã‚¤ã‚¹æ¤œå‡ºãƒ†ã‚¹ãƒˆ**
4. **ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯**

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«

```yaml
.github/workflows/build-and-test.yml
```

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œãƒ•ãƒ­ãƒ¼

```
Push to GitHub
    â†“
build ã‚¸ãƒ§ãƒ–
â”œâ”€â”€ Setup .NET
â”œâ”€â”€ Restore dependencies
â”œâ”€â”€ Build (Debug)
â”œâ”€â”€ Build (Release)
â”œâ”€â”€ Run unit tests
â””â”€â”€ Test device detection
    â†“
test-keyboard-events ã‚¸ãƒ§ãƒ–
â”œâ”€â”€ Setup .NET
â”œâ”€â”€ Run keyboard event tests
â””â”€â”€ Upload test results
    â†“
code-quality ã‚¸ãƒ§ãƒ–
â””â”€â”€ Check code style
    â†“
publish ã‚¸ãƒ§ãƒ– (main ãƒ–ãƒ©ãƒ³ãƒã®ã¿)
â”œâ”€â”€ Publish (Windows x64)
â”œâ”€â”€ Create Release Archive
â””â”€â”€ Upload Release Artifact
```

### ãƒ†ã‚¹ãƒˆçµæœã®ç¢ºèª

1. GitHub ãƒªãƒã‚¸ãƒˆãƒªã® **Actions** ã‚¿ãƒ–ã‚’é–‹ã
2. æœ€æ–°ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œã‚’é¸æŠ
3. å„ã‚¸ãƒ§ãƒ–ã®è©³ç´°ã‚’ç¢ºèª

#### ãƒ†ã‚¹ãƒˆçµæœã®ä¾‹

```
test-keyboard-events ã‚¸ãƒ§ãƒ–
â”œâ”€â”€ âœ… TestRemapCapsLockToLCtrl - PASSED
â”œâ”€â”€ âœ… TestRemapMultipleKeys - PASSED
â”œâ”€â”€ âœ… TestSwapCapsLockAndLCtrl - PASSED
â”œâ”€â”€ âœ… TestDisableKey - PASSED
â”œâ”€â”€ âœ… TestDeviceSpecificMapping - PASSED
â”œâ”€â”€ âœ… TestPerformanceWithManyMappings - PASSED
â””â”€â”€ âœ… åˆè¨ˆ: 18 ãƒ†ã‚¹ãƒˆ, 18 æˆåŠŸ, 0 å¤±æ•—
```

## ãƒ†ã‚¹ãƒˆçµæœã®è§£é‡ˆ

### æˆåŠŸæ™‚

```
Test Run Successful.
Total tests: 18
     Passed: 18
     Failed: 0
  Skipped: 0
```

### å¤±æ•—æ™‚

```
Test Run Failed.
Total tests: 18
     Passed: 17
     Failed: 1
  Skipped: 0

FAILED KeyboardRemapper.Tests.KeyRemapEngineTests.TestRemapCapsLockToLCtrl
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œã•ã‚Œãªã„

**åŸå› **: ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒè¦‹ã¤ã‹ã‚‰ãªã„

**è§£æ±ºæ–¹æ³•**:
```bash
# ãƒ†ã‚¹ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç¢ºèª
dotnet sln list
```

### ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹

**åŸå› **: ã‚­ãƒ¼ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒã‚°

**è§£æ±ºæ–¹æ³•**:
1. å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã®è©³ç´°ã‚’ç¢ºèª
2. `KeyRemapEngine.cs` ã®è©²å½“ç®‡æ‰€ã‚’ä¿®æ­£
3. ãƒ†ã‚¹ãƒˆã‚’å†å®Ÿè¡Œ

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ

**åŸå› **: å‡¦ç†ãŒé…ã„

**è§£æ±ºæ–¹æ³•**:
1. `KeyRemapEngine.cs` ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’æœ€é©åŒ–
2. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’æ”¹å–„

## ãƒ†ã‚¹ãƒˆè¿½åŠ ã‚¬ã‚¤ãƒ‰

æ–°ã—ã„ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã™ã‚‹å ´åˆ:

1. `KeyboardRemapper.Tests/KeyRemapEngineTests.cs` ã‚’é–‹ã
2. æ–°ã—ã„ `[Fact]` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ 
3. Arrange â†’ Act â†’ Assert ãƒ‘ã‚¿ãƒ¼ãƒ³ã§å®Ÿè£…
4. ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦å‹•ä½œç¢ºèª

### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

```csharp
[Fact]
public void TestNewFeature()
{
    // Arrange: ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚’æº–å‚™
    var deviceId = "04FE:0021";
    var mapping = new KeyMapping { /* ... */ };
    _engine.AddMapping(deviceId, mapping);

    // Act: ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®å‡¦ç†ã‚’å®Ÿè¡Œ
    var result = _engine.ProcessKeyEvent(deviceId, "CapsLock", true);

    // Assert: çµæœã‚’æ¤œè¨¼
    Assert.NotNull(result);
    Assert.Equal("LCtrl", result.MappedKey);
}
```

## CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

### ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸

GitHub ãƒªãƒã‚¸ãƒˆãƒªã® README ã«ä»¥ä¸‹ã‚’è¿½åŠ :

```markdown
[![Build and Test](https://github.com/tkykszk/KeyboardRemapper/workflows/Build%20and%20Test/badge.svg)](https://github.com/tkykszk/KeyboardRemapper/actions)
```

### ãƒ†ã‚¹ãƒˆçµæœã®å…¬é–‹

ãƒ†ã‚¹ãƒˆçµæœã¯è‡ªå‹•çš„ã« GitHub Actions ã«è¨˜éŒ²ã•ã‚Œã¾ã™ã€‚

---

**ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œã‚’é€šã˜ã¦ã€KeyboardRemapper ã®å“è³ªã¨ä¿¡é ¼æ€§ã‚’ç¢ºä¿ã—ã¦ã„ã¾ã™ã€‚** ğŸ§ª
